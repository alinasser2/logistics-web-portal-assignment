<!-- features/shipments/components/list-shipments/list-shipments.component.html -->
<div class="shipments-container">
  <h2>Shipments</h2>

  <!-- Success Message -->
  <ng-container *ngIf="success$ | async as success">
    <div class="alert alert-success" *ngIf="success">{{ success }}</div>
  </ng-container>

  <!-- Error Message -->
  <ng-container *ngIf="error$ | async as error">
    <div class="alert alert-danger" *ngIf="error">{{ error }}</div>
  </ng-container>

  <!-- Create Shipment Button -->
  <button class="btn btn-primary mb-3" (click)="toggleCreateForm()">
    {{ showCreateForm ? 'Cancel' : 'Create Shipment' }}
  </button>

  <!-- Create Shipment Form -->
  <div class="create-form" *ngIf="showCreateForm">
    <form [formGroup]="shipmentForm" (ngSubmit)="onCreateSubmit()">
      <div class="form-group">
        <label for="trackingId">Tracking ID</label>
        <input
          id="trackingId"
          formControlName="trackingId"
          class="form-control"
          [class.is-invalid]="shipmentForm.get('trackingId')?.invalid && shipmentForm.get('trackingId')?.touched"
        />
        <div
          class="invalid-feedback"
          *ngIf="shipmentForm.get('trackingId')?.hasError('required') && shipmentForm.get('trackingId')?.touched"
        >
          Tracking ID is required.
        </div>
      </div>

      <div class="form-group">
        <label for="phoneNumber">Phone Number</label>
        <input
          id="phoneNumber"
          formControlName="phoneNumber"
          class="form-control"
          [class.is-invalid]="shipmentForm.get('phoneNumber')?.invalid && shipmentForm.get('phoneNumber')?.touched"
        />
        <div
          class="invalid-feedback"
          *ngIf="shipmentForm.get('phoneNumber')?.hasError('required') && shipmentForm.get('phoneNumber')?.touched"
        >
          Phone number is required.
        </div>
        <div
          class="invalid-feedback"
          *ngIf="shipmentForm.get('phoneNumber')?.hasError('invalidPhoneNumber') && shipmentForm.get('phoneNumber')?.touched"
        >
          Please enter a valid Egyptian phone number.
        </div>
      </div>

      <div class="form-group">
        <label for="description">Description</label>
        <textarea
          id="description"
          formControlName="description"
          class="form-control"
          [class.is-invalid]="shipmentForm.get('description')?.invalid && shipmentForm.get('description')?.touched"
        ></textarea>
        <div
          class="invalid-feedback"
          *ngIf="shipmentForm.get('description')?.hasError('required') && shipmentForm.get('description')?.touched"
        >
          Description is required.
        </div>
      </div>

      <button type="submit" class="btn btn-success" [disabled]="shipmentForm.invalid">Create Shipment</button>
    </form>
  </div>

  <!-- Loading Indicator -->
  <div class="loading" *ngIf="loading$ | async">Loading shipments...</div>

  <!-- Shipments Table -->
  <table class="table table-striped" *ngIf="!(loading$ | async) && (shipments$ | async)?.length">
    <thead>
      <tr>
        <th>Tracking ID</th>
        <th>Phone Number</th>
        <th>Description</th>
        <th>Status</th>
        <th>Created At</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let shipment of shipments$ | async">
        <td>{{ shipment.trackingId }}</td>
        <td>{{ shipment.phoneNumber }}</td>
        <td>{{ shipment.description }}</td>
        <td>{{ shipment.status }}</td>
        <td>{{ shipment.createdAt | date: 'medium' }}</td>
        <td>
          <button
            class="btn btn-sm btn-warning mr-2"
            (click)="onCheckout(shipment.id)"
            [disabled]="shipment.status !== 'Ready to Pick Up'"
          >
            Checkout
          </button>
          <button
            class="btn btn-sm btn-success mr-2"
            (click)="onDeliver(shipment.id)"
            [disabled]="shipment.status !== 'Out for Delivery'"
          >
            Deliver
          </button>
          <button class="btn btn-sm btn-danger" (click)="onDelete(shipment.id)">Delete</button>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- No Shipments Message -->
  <div *ngIf="!(loading$ | async) && !(shipments$ | async)?.length" class="alert alert-info">
    No shipments found.
  </div>

  <!-- Pagination -->
  <div class="pagination" *ngIf="pagination$ | async as pagination">
    <button
      class="btn btn-secondary mr-2"
      (click)="previousPage()"
      [disabled]="pagination.currentPage === 1"
    >
      Previous
    </button>
    <span>Page {{ pagination.currentPage }} of {{ pagination.totalPages }}</span>
    <button
      class="btn btn-secondary ml-2"
      (click)="nextPage()"
      [disabled]="pagination.currentPage === pagination.totalPages"
    >
      Next
    </button>
  </div>
</div>